generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("account")
}

model Session {
  id             String   @id
  expiresAt      DateTime
  token          String   @unique
  createdAt      DateTime
  updatedAt      DateTime
  ipAddress      String?
  userAgent      String?
  userId         String
  impersonatedBy String?
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model User {
  id                                           String           @id
  name                                         String
  email                                        String           @unique
  emailVerified                                Boolean
  image                                        String?
  createdAt                                    DateTime
  updatedAt                                    DateTime
  role                                         String?
  banned                                       Boolean?
  banReason                                    String?
  banExpires                                   DateTime?
  accounts                                     Account[]
  blogs                                        blog[]
  investorLeads                                InvestorLead[]
  properties                                   Property[]
  rental_booking_rental_booking_agent_idTouser rental_booking[] @relation("rental_booking_agent_idTouser")
  rental_booking_rental_booking_userIdTouser   rental_booking[] @relation("rental_booking_userIdTouser")
  rentalLeads                                  RentalLead[]     @relation("RentalLeadAssignee")
  sessions                                     Session[]
  fbMarketplaceLeads                           FbMarketplaceLead[] @relation("FbMarketplaceLeadAssignee")

  @@map("user")
}

model Verification {
  id         String    @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

model Property {
  id                            String                  @id @default(cuid())
  title                         String
  slug                          String                  @unique
  location                      String
  price                         String
  beds                          Int
  baths                         Float
  sqft                          Int
  type                          PropertyType
  category                      PropertyCategory        @default(RESIDENTIAL_HOME)
  tag                           String?
  status                        Status                  @default(ACTIVE)
  image                         String
  shortDescription              String?
  descriptionParagraphs         Json?
  propertyFeatures              Json?
  amenities                     String[]
  amenitiesWithIcons            Json?
  content                       String
  yearBuilt                     Int?
  mapUrl                        String?
  userId                        String
  createdAt                     DateTime                @default(now())
  updatedAt                     DateTime                @updatedAt
  isHighlighted                 Boolean                 @default(false)
  listingNumber                 String?                 @unique
  isResale                      Boolean?                @default(false)
  ownershipType                 OwnershipType?
  beachScore                    Int?
  convenienceScore              Int?
  district                      String?
  familyScore                   Int?
  hasSeaView                    Boolean                 @default(false)
  latitude                      Float?
  longitude                     Float?
  poisLastCalculatedAt          DateTime?
  quietnessScore                Int?
  seaDistance                   Int?
  seaViewDirection              String?
  provinceSlug                  String?
  areaSlug                      String?
  ownerCompany                  String?
  ownerCountryCode              String?                 @default("+66")
  ownerEmail                    String?
  ownerName                     String?
  ownerNotes                    String?
  ownerPhone                    String?
  commissionRate                Float?                  @default(3.0)
  plotSize                      Int?
  allowPets                     Boolean                 @default(false)
  enableDailyRental             Boolean                 @default(false)
  maxGuests                     Int?
  monthlyRentalPrice            Float?
  default_access_code           String?
  default_check_in_time         String?                 @default("14:00")
  default_check_out_time        String?                 @default("11:00")
  default_emergency_contact     String?
  default_house_rules           String?
  default_property_address      String?
  default_property_instructions String?
  default_wifi_name             String?
  default_wifi_password         String?
  tm30_accommodation_id         String?
  tm30_accommodation_name       String?
  bluebook_house_id             String?
  bluebook_url                  String?
  property_owner_id             String?
  property_owner                property_owner?         @relation(fields: [property_owner_id], references: [id])
  user                          User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  property_blocked_date         property_blocked_date[]
  images                        PropertyImage[]
  poiDistances                  PropertyPoiDistance[]
  views                         PropertyView[]
  rental_booking                rental_booking[]
  tm30_accommodation            tm30_accommodation?
  viewingRequests               ViewingRequest[]
  owner_agreements              owner_agreement[]

  @@index([beachScore])
  @@index([convenienceScore])
  @@index([district])
  @@index([familyScore])
  @@index([latitude, longitude])
  @@map("property")
}

model PropertyView {
  id         String   @id @default(cuid())
  propertyId String
  viewedAt   DateTime @default(now())
  country    String?
  city       String?
  ipHash     String?
  userAgent  String?
  referrer   String?
  sessionId  String?
  
  // UTM tracking parameters
  utmSource   String? @map("utm_source")   // e.g., facebook, google, partner_site
  utmMedium   String? @map("utm_medium")   // e.g., marketplace, social, email
  utmCampaign String? @map("utm_campaign") // e.g., december_2024, villa_promo
  utmTerm     String? @map("utm_term")     // Paid keywords (optional)
  utmContent  String? @map("utm_content")  // A/B test variant (optional)
  
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([viewedAt])
  @@index([country])
  @@index([utmSource], map: "idx_property_view_utm_source")
  @@index([utmCampaign], map: "idx_property_view_utm_campaign")
  @@map("property_view")
}

model PropertyImage {
  id         String   @id @default(cuid())
  propertyId String
  url        String?
  position   Int
  alt        String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([propertyId, position])
  @@map("property_image")
}

model ViewingRequest {
  id              String        @id @default(cuid())
  propertyId      String?
  requestType     RequestType
  viewingDate     DateTime?
  name            String
  email           String
  phone           String
  countryCode     String        @default("+66")
  language        String?
  message         String?
  status          RequestStatus @default(PENDING)
  confirmedBy     String?
  confirmedByName String?
  confirmedAt     DateTime?
  completedBy     String?
  completedByName String?
  completedAt     DateTime?
  cancelledBy     String?
  cancelledByName String?
  cancelledAt     DateTime?
  ipAddress       String?
  userAgent       String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  offerAmount     String?
  offerCurrency   String?       @default("THB")
  
  // UTM tracking parameters for attribution
  utmSource   String? @map("utm_source")
  utmMedium   String? @map("utm_medium")
  utmCampaign String? @map("utm_campaign")
  utmTerm     String? @map("utm_term")
  utmContent  String? @map("utm_content")
  
  property        Property?     @relation(fields: [propertyId], references: [id])

  @@index([utmSource], map: "idx_viewing_request_utm_source")
  @@map("viewing_request")
}

model InvestorLead {
  id               String     @id @default(cuid())
  name             String
  email            String
  phone            String
  countryCode      String     @default("+66")
  currency         String     @default("EUR")
  investmentBudget String
  investmentGoal   String
  timeline         String
  preferredAreas   String?
  propertyType     String?
  experience       String?
  financing        String?
  message          String?
  newsletter       Boolean    @default(true)
  status           LeadStatus @default(NEW)
  assignedToId     String?
  ipAddress        String?
  userAgent        String?
  source           String?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  
  // UTM tracking parameters for attribution
  utmSource   String? @map("utm_source")
  utmMedium   String? @map("utm_medium")
  utmCampaign String? @map("utm_campaign")
  utmTerm     String? @map("utm_term")
  utmContent  String? @map("utm_content")
  
  assignedTo       User?      @relation(fields: [assignedToId], references: [id])

  @@index([email])
  @@index([status])
  @@index([createdAt])
  @@index([utmSource], map: "idx_investor_lead_utm_source")
  @@map("investor_lead")
}

model RentalLead {
  id             String           @id @default(cuid())
  name           String
  email          String
  phone          String
  countryCode    String           @default("+66")
  propertyType   String
  bedrooms       String
  budget         String
  rentalDuration String
  preferredAreas String?
  moveInDate     String?
  furnished      String?
  pets           String?
  message        String?
  newsletter     Boolean          @default(true)
  status         RentalLeadStatus @default(NEW)
  assignedToId   String?
  ipAddress      String?
  userAgent      String?
  source         String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  
  // UTM tracking parameters for attribution
  utmSource   String? @map("utm_source")
  utmMedium   String? @map("utm_medium")
  utmCampaign String? @map("utm_campaign")
  utmTerm     String? @map("utm_term")
  utmContent  String? @map("utm_content")
  
  assignedTo     User?            @relation("RentalLeadAssignee", fields: [assignedToId], references: [id])

  @@index([email])
  @@index([status])
  @@index([createdAt])
  @@index([utmSource], map: "idx_rental_lead_utm_source")
  @@map("rental_lead")
}

model agent_invite {
  id        String    @id
  code      String    @unique
  email     String?
  role      String    @default("AGENT")
  maxUses   Int       @default(1)
  usedCount Int       @default(0)
  usedBy    String?
  usedAt    DateTime?
  expiresAt DateTime?
  isActive  Boolean   @default(true)
  createdBy String
  note      String?
  createdAt DateTime  @default(now())
  updatedAt DateTime

  @@index([code])
  @@index([email])
  @@index([isActive])
}

model blog {
  id                     String         @id
  title                  String
  slug                   String         @unique
  excerpt                String
  content                String
  coverImage             String?
  coverImageAlt          String?
  tag                    String?
  metaTitle              String?
  metaDescription        String?
  categoryId             String?
  published              Boolean        @default(false)
  publishedAt            DateTime?
  authorId               String
  createdAt              DateTime       @default(now())
  updatedAt              DateTime
  internalLinkCount      Int            @default(0)
  linkOptimizedAt        DateTime?
  originalContent        String?
  has_dynamic_properties Boolean        @default(false)
  poi_query_params       String?
  poi_template_id        String?
  author                 User           @relation(fields: [authorId], references: [id], onDelete: Cascade)
  category               blog_category? @relation(fields: [categoryId], references: [id])
  linkUsages             link_usage[]

  @@index([categoryId])
  @@index([createdAt])
  @@index([linkOptimizedAt])
  @@index([published])
  @@index([slug])
}

model blog_category {
  id                  String          @id
  name                String
  slug                String          @unique
  description         String?
  parentId            String?
  metaTitle           String?
  metaDescription     String?
  icon                String?
  color               String?
  order               Int             @default(0)
  isActive            Boolean         @default(true)
  createdAt           DateTime        @default(now())
  updatedAt           DateTime
  blog                blog[]
  blog_category       blog_category?  @relation("blog_categoryToblog_category", fields: [parentId], references: [id])
  other_blog_category blog_category[] @relation("blog_categoryToblog_category")

  @@index([isActive])
  @@index([parentId])
}

model blog_schedule_settings {
  id                  String   @id @default("default")
  maxBlogsPerWeek     Int      @default(3)
  minDaysBetweenPosts Int      @default(2)
  preferredPostTime   String?  @default("09:00")
  preferredPostDays   String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime
}

model booking_guest {
  id                   String          @id
  booking_id           String
  guest_type           String          @default("adult")
  guest_number         Int             @default(1)
  first_name           String?
  last_name            String?
  full_name            String?
  date_of_birth        DateTime?
  nationality          String?
  gender               String?
  passport_number      String?
  passport_expiry      DateTime?
  passport_issue_date  DateTime?
  passport_country     String?
  passport_image_url   String?
  passport_image_path  String?
  ocr_confidence       Float?
  ocr_raw_data         Json?
  ocr_processed_at     DateTime?
  passport_verified    Boolean         @default(false)
  verified_by          String?
  verified_at          DateTime?
  tm30_status          TM30GuestStatus @default(PENDING)
  tm30_submitted_at    DateTime?
  tm30_error           String?
  whatsapp_message_id  String?
  whatsapp_received_at DateTime?
  created_at           DateTime        @default(now())
  updated_at           DateTime
  rental_booking       rental_booking  @relation(fields: [booking_id], references: [id], onDelete: Cascade)

  @@index([booking_id])
  @@index([passport_number])
  @@index([tm30_status])
}

model booking_message {
  id             String         @id
  booking_id     String
  sender_id      String
  sender_role    String         @default("customer")
  message        String
  is_read        Boolean        @default(false)
  created_at     DateTime       @default(now())
  updated_at     DateTime
  rental_booking rental_booking @relation(fields: [booking_id], references: [id], onDelete: Cascade)

  @@index([booking_id])
  @@index([created_at])
  @@index([sender_id])
}

model company_profile {
  id              String    @id @default("default")
  companyName     String?
  tagline         String?
  description     String?
  tone            String?   @default("professional")
  writingStyle    String?
  targetAudience  String?
  targetLocations String?
  usps            String?
  expertise       String?
  contentThemes   String?
  brandKeywords   String?
  avoidTopics     String?
  competitors     String?
  websiteUrl      String?
  lastAnalyzedAt  DateTime?
  analysisData    String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
}

model HeroImage {
  id            String         @id
  page          String         @default("home")
  deviceType    HeroDeviceType
  imageUrl      String
  alt           String
  fileName      String?
  originalUrl   String?
  width         Int?
  height        Int?
  isAiGenerated Boolean        @default(false)
  aiPrompt      String?
  originalSize  Int?
  optimizedSize Int?
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime

  @@unique([page, deviceType])
  @@index([isActive])
  @@index([page])
  @@map("hero_image")
}

model internal_link {
  id          String       @id
  url         String       @unique
  title       String
  description String?
  category    String?
  keywords    String?
  priority    Int          @default(1)
  isActive    Boolean      @default(true)
  usageCount  Int          @default(0)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime
  anchorTexts String?
  lastChecked DateTime?
  pageExists  Boolean      @default(true)
  subCategory String?
  link_usage  link_usage[]

  @@index([category])
  @@index([isActive])
  @@index([pageExists])
}

model LandingPage {
  id              String   @id @default(cuid())
  url             String   @unique
  title           String
  category        String
  metaTitle       String?
  metaDescription String?
  content         String
  faq             Json?
  published       Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([category])
  @@index([published])
  @@map("landing_page")
}

model LandingPageSuggestion {
  id             String            @id @default(cuid())
  suggestedUrl   String            @unique
  suggestedTitle String
  description    String?
  category       String
  reason         String?
  mentionCount   Int               @default(1)
  sourceBlogs    String?
  status         LandingPageStatus @default(PENDING)
  createdPageUrl String?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt

  @@index([mentionCount])
  @@index([status])
  @@map("landing_page_suggestion")
}

model link_usage {
  id              String        @id
  linkId          String
  blogId          String
  anchorText      String
  context         String?
  position        Int?
  wasAutoInserted Boolean       @default(false)
  insertedAt      DateTime      @default(now())
  createdAt       DateTime      @default(now())
  blog            blog          @relation(fields: [blogId], references: [id], onDelete: Cascade)
  internal_link   internal_link @relation(fields: [linkId], references: [id], onDelete: Cascade)

  @@index([blogId])
  @@index([linkId])
}

model owner_document {
  id                String            @id
  owner_id          String
  document_type     OwnerDocumentType
  image_url         String
  image_path        String
  file_name         String?
  ocr_data          Json?
  ocr_processed_at  DateTime?
  ocr_confidence    Float?
  property_id       String?           @unique
  house_id          String?
  extracted_address String?
  is_verified       Boolean           @default(false)
  verified_by       String?
  verified_at       DateTime?
  created_at        DateTime          @default(now())
  updated_at        DateTime
  property_owner    property_owner    @relation(fields: [owner_id], references: [id], onDelete: Cascade)

  @@index([document_type])
  @@index([owner_id])
  @@index([property_id])
}

model owner_agreement {
  id              String   @id @default(cuid())
  propertyId      String
  commissionRate  Float
  message         String   @db.Text
  sentVia         String   // "WHATSAPP" or "EMAIL"
  recipientName   String?
  recipientPhone  String?
  recipientEmail  String?
  sentBy          String
  sentByName      String
  sentAt          DateTime @default(now())
  
  property        Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  @@index([propertyId])
}

model Poi {
  id                    String                  @id
  externalId            String?
  source                PoiSource               @default(OSM)
  name                  String
  nameTh                String?
  nameLocal             String?
  category              PoiCategory
  subCategory           String?
  latitude              Float
  longitude             Float
  address               String?
  district              String?
  osmTags               Json?
  importance            Int                     @default(5)
  isVerified            Boolean                 @default(false)
  isActive              Boolean                 @default(true)
  noiseLevel            NoiseLevel?
  trafficLevel          TrafficLevel?
  lastSyncedAt          DateTime?
  syncError             String?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  propertyDistances     PropertyPoiDistance[]

  @@unique([externalId, source])
  @@index([category])
  @@index([district])
  @@index([isActive])
  @@index([latitude, longitude])
  @@index([subCategory])
  @@map("poi")
}

model PoiSyncJob {
  id           String           @id
  jobType      PoiSyncJobType
  status       PoiSyncJobStatus @default(PENDING)
  category     PoiCategory?
  district     String?
  poisFetched  Int              @default(0)
  poisCreated  Int              @default(0)
  poisUpdated  Int              @default(0)
  poisSkipped  Int              @default(0)
  startedAt    DateTime?
  completedAt  DateTime?
  errorMessage String?
  errorStack   String?
  createdAt    DateTime         @default(now())

  @@index([createdAt])
  @@index([status])
  @@map("poi_sync_job")
}

model property_alert {
  id                String            @id
  email             String
  name              String?
  phone             String?
  countryCode       String            @default("+66")
  userId            String?
  propertyType      PropertyType?
  category          PropertyCategory?
  locations         String?
  minPrice          Int?
  maxPrice          Int?
  minBeds           Int?
  maxBeds           Int?
  minBaths          Int?
  maxBaths          Int?
  minSqft           Int?
  maxSqft           Int?
  notifyImmediately Boolean           @default(true)
  notifyDigest      Boolean           @default(false)
  digestDay         String?           @default("Monday")
  isActive          Boolean           @default(true)
  lastNotifiedAt    DateTime?
  matchCount        Int               @default(0)
  notificationCount Int               @default(0)
  verificationToken String?           @unique
  isVerified        Boolean           @default(false)
  verifiedAt        DateTime?
  unsubscribeToken  String            @unique
  ipAddress         String?
  userAgent         String?
  source            String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime

  @@index([createdAt])
  @@index([email])
  @@index([isActive])
  @@index([propertyType])
}

model property_alert_notification {
  id            String    @id
  alertId       String
  propertyIds   String
  propertyCount Int
  emailSent     Boolean   @default(false)
  emailSentAt   DateTime?
  emailError    String?
  opened        Boolean   @default(false)
  openedAt      DateTime?
  clicked       Boolean   @default(false)
  clickedAt     DateTime?
  createdAt     DateTime  @default(now())

  @@index([alertId])
  @@index([createdAt])
}

model property_blocked_date {
  id          String   @id
  property_id String
  start_date  DateTime
  end_date    DateTime
  reason      String?
  blocked_by  String?
  created_at  DateTime @default(now())
  updated_at  DateTime
  property    Property @relation(fields: [property_id], references: [id], onDelete: Cascade)

  @@index([property_id])
  @@index([start_date, end_date])
}

model property_owner {
  id                         String                       @id
  first_name                 String
  last_name                  String
  thai_id_number             String?                      @unique
  phone                      String                       @unique
  email                      String?
  gender                     String?
  id_card_url                String?
  id_card_path               String?
  id_card_ocr_data           Json?
  id_card_verified           Boolean                      @default(false)
  id_card_uploaded_at        DateTime?
  is_active                  Boolean                      @default(true)
  is_verified                Boolean                      @default(false)
  created_at                 DateTime                     @default(now())
  updated_at                 DateTime
  owner_document             owner_document[]
  property                   Property[]
  tm30_accommodation_request tm30_accommodation_request[]

  @@index([last_name])
  @@index([phone])
  @@index([thai_id_number])
}

model PropertyPoiDistance {
  id             String   @id
  propertyId     String
  poiId          String
  distanceMeters Int
  walkingMinutes Int?
  drivingMinutes Int?
  isHighlight    Boolean  @default(false)
  calculatedAt   DateTime @default(now())
  poi            Poi      @relation(fields: [poiId], references: [id], onDelete: Cascade)
  property       Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([propertyId, poiId])
  @@index([distanceMeters])
  @@index([poiId])
  @@index([propertyId])
  @@map("property_poi_distance")
}

model property_submission {
  id                  String           @id
  ownerName           String
  ownerEmail          String
  ownerPhone          String
  ownerCountryCode    String           @default("+66")
  accessToken         String           @unique
  propertyTitle       String
  propertyCategory    PropertyCategory
  propertyType        PropertyType
  location            String
  askingPrice         String
  beds                Int
  baths               Float
  sqft                Int
  description         String
  images              String[]
  exclusiveRights     Boolean          @default(false)
  commissionRate      Float            @default(3.0)
  agreementAccepted   Boolean          @default(false)
  status              SubmissionStatus @default(PENDING_REVIEW)
  reviewNotes         String?
  reviewedBy          String?
  reviewedByName      String?
  reviewedAt          DateTime?
  imagesApprovedAt    DateTime?
  imagesApprovedBy    String?
  publishedAt         DateTime?
  publishedBy         String?
  convertedPropertyId String?
  ipAddress           String?
  userAgent           String?
  source              String?
  createdAt           DateTime         @default(now())
  updatedAt           DateTime

  @@index([accessToken])
  @@index([createdAt])
  @@index([ownerEmail])
  @@index([status])
}

model rental_booking {
  id                                 String              @id
  propertyId                         String
  checkIn                            DateTime
  checkOut                           DateTime
  nights                             Int
  adults                             Int                 @default(1)
  children                           Int                 @default(0)
  babies                             Int                 @default(0)
  pets                               Int                 @default(0)
  basePrice                          Float
  season                             String
  discountPercent                    Float
  totalPrice                         Float
  guestName                          String
  guestEmail                         String
  guestPhone                         String
  guestCountryCode                   String              @default("+66")
  guestMessage                       String?
  status                             RentalBookingStatus @default(PENDING)
  paymentStatus                      String?
  cancellationPolicy                 String?
  cancelledAt                        DateTime?
  cancellationReason                 String?
  internalNotes                      String?
  createdAt                          DateTime            @default(now())
  updatedAt                          DateTime
  userId                             String
  check_in_time                      String?             @default("14:00")
  check_out_time                     String?             @default("11:00")
  property_address                   String?
  property_instructions              String?
  wifi_name                          String?
  wifi_password                      String?
  access_code                        String?
  emergency_contact                  String?
  house_rules                        String?
  confirmed_at                       DateTime?
  agent_id                           String?
  passports_received                 Int                 @default(0)
  passports_required                 Int                 @default(0)
  tm30_error                         String?
  tm30_reference                     String?
  tm30_status                        TM30BookingStatus   @default(PENDING)
  tm30_submitted_at                  DateTime?
  booking_guest                      booking_guest[]
  booking_message                    booking_message[]
  user_rental_booking_agent_idTouser User?               @relation("rental_booking_agent_idTouser", fields: [agent_id], references: [id])
  property                           Property            @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  user_rental_booking_userIdTouser   User                @relation("rental_booking_userIdTouser", fields: [userId], references: [id], onDelete: Cascade)

  @@index([checkIn, checkOut])
  @@index([propertyId])
  @@index([status])
  @@index([tm30_status])
  @@index([userId])
}

model rental_pricing_config {
  id                   String   @id @default("default")
  createdAt            DateTime @default(now())
  updatedAt            DateTime @default(now()) @updatedAt
  lowSeasonSurcharges  Json     @default("[{\"maxDays\": 7, \"minDays\": 1, \"surchargePercent\": 20}, {\"maxDays\": 14, \"minDays\": 8, \"surchargePercent\": 17}, {\"maxDays\": 19, \"minDays\": 15, \"surchargePercent\": 13}, {\"maxDays\": 30, \"minDays\": 20, \"surchargePercent\": 0}]")
  maximumStayDays      Int      @default(30)
  minimumStayDays      Int      @default(1)
  peakSeasonMonths     Int[]    @default([12, 1, 2])
  peakSeasonSurcharges Json     @default("[{\"maxDays\": 7, \"minDays\": 1, \"surchargePercent\": 30}, {\"maxDays\": 14, \"minDays\": 8, \"surchargePercent\": 20}, {\"maxDays\": 19, \"minDays\": 15, \"surchargePercent\": 15}, {\"maxDays\": 30, \"minDays\": 20, \"surchargePercent\": 0}]")
}

model property_favorites {
  id          String   @id @default(uuid())
  user_id     String
  property_id String
  created_at  DateTime @default(now())

  @@unique([user_id, property_id])
  @@index([user_id])
  @@index([property_id])
}

model scheduled_blog {
  id                  String              @id
  topicId             String?
  topicTitle          String
  language            String              @default("en")
  length              String              @default("medium")
  tone                String              @default("professional")
  includeResearch     Boolean             @default(true)
  scheduledFor        DateTime
  scheduledBy         String
  status              ScheduledBlogStatus @default(SCHEDULED)
  generatedBlogId     String?
  processingStartedAt DateTime?
  processedAt         DateTime?
  errorMessage        String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime

  @@index([scheduledFor])
  @@index([status])
}

model site_settings {
  id                  String    @id @default("default")
  smtpHost            String?
  smtpPort            Int?      @default(587)
  smtpSecure          Boolean   @default(false)
  smtpUser            String?
  smtpPassword        String?
  smtpFromName        String?   @default("Real Estate Pulse")
  smtpFromEmail       String?
  siteName            String?   @default("Real Estate Pulse")
  siteEmail           String?
  adminNotifyEmail    String?
  notifyOnSubmission  Boolean   @default(true)
  notifyOnImageUpload Boolean   @default(true)
  companyDescription  String?
  companyTone         String?   @default("professional")
  companyUSPs         String?
  targetAudience      String?
  brandKeywords       String?
  avoidTopics         String?
  websiteUrl          String?
  lastScannedAt       DateTime?
  scannedPagesCount   Int?
  scanConfidence      Float?
  detectedThemes      String?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime
}

model tm30_accommodation {
  id             String    @id
  tm30_id        String
  name           String
  address        String
  status         String?   @default("Pending")
  property_id    String?   @unique
  match_score    Float?
  matched_by     String?
  matched_at     DateTime?
  last_synced_at DateTime?
  sync_source    String?
  created_at     DateTime? @default(now())
  updated_at     DateTime?
  property       Property? @relation(fields: [property_id], references: [id])

  @@index([name])
  @@index([property_id])
  @@index([status])
}

model tm30_accommodation_request {
  id                       String                 @id
  owner_same_as_registrant Boolean                @default(true)
  owner_national_type      String                 @default("THAI")
  owner_national_id        String?
  owner_passport_number    String?
  owner_first_name         String
  owner_middle_name        String?
  owner_last_name          String
  owner_telephone          String
  owner_gender             String?
  entity_type              String                 @default("INDIVIDUAL")
  house_id_number          String?
  accommodation_type       String
  accommodation_name       String
  position                 String?
  position_other           String?
  address_number           String
  village_number           String?
  alley                    String?
  road                     String?
  province                 String
  district                 String
  sub_district             String
  postal_code              String
  latitude                 Float?
  longitude                Float?
  house_registration_url   String?
  house_registration_path  String?
  ocr_processed            Boolean                @default(false)
  ocr_processed_at         DateTime?
  ocr_raw_data             Json?
  ocr_confidence           Float?
  status                   Tm30AccomRequestStatus @default(DRAFT)
  tm30_id                  String?
  submitted_at             DateTime?
  approved_at              DateTime?
  rejected_at              DateTime?
  rejection_reason         String?
  error_message            String?
  property_id              String?                @unique
  created_by               String?
  updated_by               String?
  created_at               DateTime               @default(now())
  updated_at               DateTime
  whatsapp_phone           String?
  whatsapp_session_id      String?
  property_owner_id        String?
  property_owner           property_owner?        @relation(fields: [property_owner_id], references: [id])

  @@index([house_id_number])
  @@index([property_id])
  @@index([property_owner_id])
  @@index([status])
  @@index([whatsapp_phone])
}

model topic_suggestion {
  id              String      @id
  title           String
  description     String?
  category        String?
  priority        String?
  difficulty      String?
  estimatedImpact String?
  language        String      @default("en")
  status          TopicStatus @default(AVAILABLE)
  usedAt          DateTime?
  generatedBlogId String?
  batchId         String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime

  @@index([batchId])
  @@index([language])
  @@index([status])
}

model whatsapp_listing_session {
  id                      String   @id
  phone                   String   @unique
  status                  String   @default("IDLE")
  current_action          String?
  owner_id                String?
  current_property_id     String?
  tm30_request_id         String?
  tm30_owner_first_name   String?
  tm30_owner_last_name    String?
  tm30_owner_gender       String?
  tm30_owner_phone        String?
  tm30_thai_id_number     String?
  tm30_id_card_url        String?
  tm30_bluebook_url       String?
  tm30_house_id           String?
  tm30_province           String?
  tm30_district           String?
  tm30_sub_district       String?
  tm30_address_number     String?
  tm30_postal_code        String?
  tm30_accommodation_name String?
  pending_data            Json?
  last_message_at         DateTime @default(now())
  created_at              DateTime @default(now())
  updated_at              DateTime

  @@index([owner_id])
  @@index([phone])
  @@index([status])
}

enum PropertyType {
  FOR_SALE
  FOR_RENT
}

enum PropertyCategory {
  LUXURY_VILLA
  APARTMENT
  RESIDENTIAL_HOME
  OFFICE_SPACES
}

enum Status {
  ACTIVE
  INACTIVE
  SOLD
  RENTED
}

enum RequestType {
  SCHEDULE_VIEWING
  MAKE_OFFER
}

enum RequestStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  PROPOSAL_SENT
  CONVERTED
  NOT_INTERESTED
  LOST
}

enum RentalLeadStatus {
  NEW
  CONTACTED
  VIEWING_SCHEDULED
  OFFER_MADE
  RENTED
  NOT_INTERESTED
  LOST
}

enum HeroDeviceType {
  DESKTOP
  MOBILE
  TABLET
}

enum LandingPageStatus {
  PENDING
  APPROVED
  CREATED
  DISMISSED
}

enum NoiseLevel {
  QUIET
  MODERATE
  BUSY
  LOUD
}

enum OwnerDocumentType {
  ID_CARD
  BLUEBOOK
  PASSPORT
  BUSINESS_REG
  OTHER
}

enum OwnershipType {
  FREEHOLD
  LEASEHOLD
}

enum PoiCategory {
  BEACH
  PARK
  VIEWPOINT
  GOLF_COURSE
  MARINA
  TEMPLE
  INTERNATIONAL_SCHOOL
  LOCAL_SCHOOL
  KINDERGARTEN
  UNIVERSITY
  HOSPITAL
  CLINIC
  PHARMACY
  DENTIST
  SHOPPING_MALL
  SUPERMARKET
  CONVENIENCE_STORE
  MARKET
  GYM
  COWORKING
  BANK
  ATM
  POST_OFFICE
  RESTAURANT
  CAFE
  BAR
  NIGHTCLUB
  MAIN_ROAD
  HIGHWAY_ACCESS
  AIRPORT
  BUS_STATION
  FERRY_TERMINAL
  TAXI_STAND
  SEA_VIEW_POINT
  MOUNTAIN_VIEW
  RIVER
  LAKE
  NIGHTLIFE_CLUSTER
  BUSY_INTERSECTION
  CONSTRUCTION_ZONE
  NEIGHBORHOOD
  TOURIST_AREA
  RESIDENTIAL_AREA
  HOTEL
  RESORT
}

enum PoiSource {
  OSM
  GOOGLE
  MANUAL
  GOVERNMENT
}

enum PoiSyncJobStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
}

enum PoiSyncJobType {
  FULL_SYNC
  CATEGORY_SYNC
  DISTRICT_SYNC
  INCREMENTAL
}

enum RentalBookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum ScheduledBlogStatus {
  SCHEDULED
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum SubmissionStatus {
  PENDING_REVIEW
  UNDER_REVIEW
  INFO_REQUESTED
  APPROVED
  IMAGES_UPLOADED
  READY_TO_PUBLISH
  PUBLISHED
  REJECTED
}

enum TM30BookingStatus {
  PENDING
  PASSPORT_RECEIVED
  PROCESSING
  SUBMITTED
  FAILED
}

enum TM30GuestStatus {
  PENDING
  SCANNED
  VERIFIED
  SUBMITTED
  FAILED
}

enum Tm30AccomRequestStatus {
  DRAFT
  PENDING
  PROCESSING
  SUBMITTED
  APPROVED
  REJECTED
  FAILED
}

enum TopicStatus {
  AVAILABLE
  SCHEDULED
  USED
  SKIPPED
}

enum TrafficLevel {
  LOW
  MEDIUM
  HIGH
  VERY_HIGH
}

// Facebook Marketplace Lead Status
enum FbLeadStatus {
  NEW
  CONTACTED
  RESPONDED
  INTERESTED
  NOT_INTERESTED
  CONVERTED
  DUPLICATE
  INVALID
}

// Facebook Marketplace Lead for property owners selling on FB Marketplace
model FbMarketplaceLead {
  id              String    @id @default(cuid())
  
  // Facebook listing data
  facebookId      String?   @unique // Marketplace listing ID
  listingUrl      String    @unique
  
  // Seller info
  sellerName      String
  sellerPhone     String?
  sellerWhatsapp  String?
  sellerLineId    String?
  sellerEmail     String?
  sellerFacebookUrl String?
  
  // Property info
  propertyTitle   String
  price           String?
  location        String?
  description     String?
  images          String[]  // Array of image URLs
  propertyType    String?   // Huis, Appartement, etc.
  bedrooms        Int?
  bathrooms       Int?
  sqm             Int?
  
  // Scraping metadata
  scrapedAt       DateTime  @default(now())
  source          String    @default("facebook_marketplace")
  rawData         Json?     // Store original scraped data
  
  // Lead management
  status          FbLeadStatus @default(NEW)
  priority        Int       @default(0)
  score           Int?      // Lead quality score
  
  // Contact tracking
  contactedAt     DateTime?
  contactMethod   String?   // phone, email, whatsapp, messenger
  contactNotes    String?
  followUpDate    DateTime?
  
  // Contact history (stored as JSON array)
  contactHistory  Json?     // Array of contact attempts
  
  // Assignment
  assignedToId    String?
  assignedTo      User?     @relation("FbMarketplaceLeadAssignee", fields: [assignedToId], references: [id])
  
  // Conversion tracking
  convertedToPropertyId String?  // Property ID if converted
  convertedAt     DateTime?
  
  // Audit
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([status])
  @@index([scrapedAt])
  @@index([location])
  @@index([assignedToId])
  @@index([createdAt])
  @@map("fb_marketplace_lead")
}
